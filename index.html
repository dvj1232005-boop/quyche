<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#b71c1c">

<style>
/* ================== ROOT ================== */
:root{
  --bg:linear-gradient(135deg,#f5f5f5,#ffffff);
  --card:#ffffff;
  --text:#111;
  --accent:#b71c1c;
}
body.dark{
  --bg:linear-gradient(135deg,#121212,#1e1e1e);
  --card:#1f1f1f;
  --text:#f5f5f5;
  --accent:#ef5350;
}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}

/* ================== INTRO ================== */
#intro{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#b71c1c,#d32f2f);
  z-index:9999;
  display:flex;
  justify-content:center;
  align-items:center;
}
.intro-content{
  text-align:center;
  color:white;
  animation:introScale 1.2s ease;
}
.intro-content img{
  width:120px;
  margin-bottom:16px;
}
@keyframes introScale{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* ================== LAYOUT ================== */
.container{
  max-width:420px;
  margin:auto;
  padding:20px;
}
.card{
  background:var(--card);
  border-radius:22px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
h2{margin-top:0}

/* ================== FORM ================== */
input,select{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,var(--accent),#ef5350);
  color:white;
  font-size:16px;
  font-weight:600;
}
.day{font-weight:600}

/* ================== MANAGER ================== */
.manager-box{
  margin-top:20px;
}
.block{
  background:#f1f1f1;
  border-radius:16px;
  padding:12px;
  margin:10px 0;
}
body.dark .block{background:#2a2a2a}
.badge{
  display:inline-block;
  background:var(--accent);
  color:white;
  padding:6px 12px;
  border-radius:999px;
  margin:4px;
  font-size:13px;
}

/* ================== FOOTER ================== */
.footer{
  margin-top:20px;
  text-align:center;
  font-size:12px;
  opacity:.6;
}

/* ================== SNOW ================== */
.snow{
  position:fixed;
  top:-10px;
  color:white;
  font-size:14px;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh)}
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div class="intro-content">
    <img src="logo.jpg">
    <h1>An Quy Ch·∫ø</h1>
    <p>H·ªá th·ªëng ƒëƒÉng k√Ω ca l√†m</p>
  </div>
</div>

<div class="container">
  <div class="card">
    <h2>üìÖ ƒêƒÉng k√Ω ca l√†m</h2>
    <input id="name" placeholder="Nh·∫≠p t√™n (Qu·∫£n l√Ω: QuanLy)">
    <div id="form"></div>
    <button onclick="submit()">‚úÖ X√°c nh·∫≠n</button>

    <div id="managerBox" class="manager-box" style="display:none">
      <h3>üìä T·ªïng h·ª£p ƒëƒÉng k√Ω</h3>
      <button onclick="clearWeek()">üßπ X√≥a to√†n b·ªô l·ªãch tu·∫ßn n√†y</button>
      <div id="summary"></div>
    </div>
  </div>

  <div class="footer">
    ¬© 2025 An Quy Ch·∫ø ‚Ä¢ Developed by ƒê√†o ƒêƒÉng T√πng
  </div>
</div>

<!-- ================== SCRIPT ================== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  authDomain: "an-quy.firebaseapp.com",
  databaseURL: "https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "an-quy",
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const days=["T2","T3","T4","T5","T6","T7","CN"];
const shifts=["C1","C2","C3","2C(C1+C2)","2C(C2+C3)","F1","F2"];

const form=document.getElementById("form");
days.forEach(d=>{
  form.innerHTML+=`
    <div>
      <div class="day">${d}</div>
      <select id="${d}">
        <option value="">Kh√¥ng l√†m</option>
        ${shifts.map(s=>`<option>${s}</option>`).join("")}
      </select>
    </div>
  `;
});

window.submit=async()=>{
  const name=nameInput.value.trim();
  if(!name) return alert("Ch∆∞a nh·∫≠p t√™n");

  if(name.toLowerCase()==="quanly"){
    const pin=prompt("Nh·∫≠p m√£ PIN");
    if(pin!=="2005") return alert("Sai PIN");

    managerBox.style.display="block";
    renderSummary();
    return;
  }

  const data={};
  days.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) data[d]=v;
  });

  await set(ref(db,"dangKy/"+name),{data});
  alert("ƒêƒÉng k√Ω th√†nh c√¥ng");
};

async function renderSummary(){
  const snap=await get(ref(db,"dangKy"));
  if(!snap.exists()) return;

  const map={};
  snap.forEach(u=>{
    const n=u.key;
    Object.entries(u.val().data||{}).forEach(([d,c])=>{
      map[d]??={};
      map[d][c]??=[];
      map[d][c].push(n);
    });
  });

  summary.innerHTML="";
  Object.entries(map).forEach(([d,cases])=>{
    summary.innerHTML+=`<h4>${d}</h4>`;
    Object.entries(cases).forEach(([c,names])=>{
      summary.innerHTML+=`
        <div class="block">
          <b>${c}</b><br>
          ${names.map(n=>`<span class="badge">${n}</span>`).join("")}
        </div>
      `;
    });
  });
}

window.clearWeek=async()=>{
  if(confirm("X√≥a to√†n b·ªô l·ªãch tu·∫ßn n√†y?")){
    await remove(ref(db,"dangKy"));
    alert("ƒê√£ x√≥a");
    summary.innerHTML="";
  }
};

// ===== INTRO REMOVE =====
setTimeout(()=>document.getElementById("intro").remove(),2200);

// ===== SNOW =====
setInterval(()=>{
  const s=document.createElement("div");
  s.className="snow";
  s.innerText="‚ùÑ";
  s.style.left=Math.random()*100+"vw";
  s.style.animationDuration=3+Math.random()*3+"s";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),6000);
},400);
</script>

</body>
</html>
