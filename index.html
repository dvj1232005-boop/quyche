<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>An Quy Cháº¿ â€“ ÄÄƒng kÃ½ ca</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0ea5a4">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
/* ===== THEME ===== */
:root{
  --bg:#020617;
  --card:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border:#0f172a;
  --primary:#0ea5a4;
}
.light{
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#475569;
  --border:#e2e8f0;
  --primary:#0ea5a4;
}

/* ===== BASE ===== */
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  transition:background .3s,color .3s;
}
header{
  padding:14px 16px;
  font-size:18px;
  font-weight:700;
  background:linear-gradient(90deg,var(--primary),#22d3ee);
  color:#001014;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  border:none;
  border-radius:14px;
  padding:14px;
  font-weight:600;
  background:var(--primary);
  color:#001014;
  transition:.2s;
}
button:active{
  transform:scale(.96);
  opacity:.9;
}
select,input{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  transition:.2s;
}
.card{
  margin:16px;
  padding:18px;
  border-radius:18px;
  border:1px solid var(--border);
  background:var(--card);
  animation:fadeUp .45s ease;
}
h3{margin:0 0 14px 0}
.hidden{display:none}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:14px;
}
td,th{
  border:1px solid var(--border);
  padding:12px;
  text-align:center;
  font-size:14px;
}

/* ===== ANIMATION ===== */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}

/* ===== MOBILE ===== */
@media(min-width:768px){
  .card{max-width:460px;margin:24px auto}
}
</style>
</head>

<body>

<header>
  <span>AN QUY CHáº¾ â€“ ÄÄ‚NG KÃ CA</span>
  <button onclick="toggleTheme()">ğŸŒ™</button>
</header>

<!-- STAFF REGISTER -->
<div class="card" id="staffBox">
  <h3>ğŸ—“ï¸ ÄÄƒng kÃ½ ca lÃ m</h3>

  <select id="day"></select>
  <select id="shift"></select>

  <input id="nameInput" placeholder="Nháº­p tÃªn (Quáº£n lÃ½ nháº­p QuanLy)">
  <button onclick="submitRegister()">XÃ¡c nháº­n Ä‘Äƒng kÃ½</button>

  <p style="margin-top:12px;font-size:13px;color:var(--muted)">
    Sau khi xÃ¡c nháº­n, báº¡n cÃ³ thá»ƒ rá»i khá»i trang.
  </p>
</div>

<!-- MANAGER -->
<div class="card hidden" id="managerBox">
  <h3>ğŸ“Š Quáº£n lÃ½ Ä‘Äƒng kÃ½ ca</h3>
  <select id="mDay"></select>
  <select id="mShift"></select>
  <div id="manageTable"></div>
</div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig={
  apiKey:"YOUR_API_KEY",
  databaseURL:"https://YOUR_PROJECT_ID.firebaseio.com",
  projectId:"YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* ===== DATA ===== */
const days=["T2","T3","T4","T5","T6","T7","CN"];
const shifts=["C1","F1","C2","F2","C3"];

/* ===== WEEK ===== */
function getWeek(){
  const d=new Date();
  d.setDate(d.getDate()+3-(d.getDay()+6)%7);
  const w1=new Date(d.getFullYear(),0,4);
  return d.getFullYear()+"-W"+
    String(1+Math.round(((d-w1)/86400000-3+(w1.getDay()+6)%7)/7)).padStart(2,"0");
}
const week=getWeek();

/* ===== INIT ===== */
day.innerHTML=days.map(d=>`<option>${d}</option>`).join("");
shift.innerHTML=shifts.map(s=>`<option>${s}</option>`).join("");
mDay.innerHTML=day.innerHTML;
mShift.innerHTML=shift.innerHTML;
mDay.onchange=mShift.onchange=loadManager;

/* ===== SUBMIT ===== */
function submitRegister(){
  const name=nameInput.value.trim();
  if(!name) return alert("ChÆ°a nháº­p tÃªn");

  if(name==="QuanLy"){
    staffBox.classList.add("hidden");
    managerBox.classList.remove("hidden");
    loadManager();
    return;
  }

  const btn=event.target;
  btn.innerText="â³ Äang gá»­i...";
  btn.disabled=true;

  db.ref(`registrations/${week}/${day.value}/${shift.value}/${name}`)
    .set(true)
    .then(()=>{
      btn.innerText="âœ… ÄÃ£ ghi nháº­n";
      setTimeout(()=>{
        btn.innerText="XÃ¡c nháº­n Ä‘Äƒng kÃ½";
        btn.disabled=false;
      },1200);
      nameInput.value="";
    });
}

/* ===== MANAGER ===== */
function loadManager(){
  db.ref(`registrations/${week}/${mDay.value}/${mShift.value}`)
    .once("value",snap=>{
      let html="<table><tr><th>ğŸ‘¤ NhÃ¢n viÃªn Ä‘Äƒng kÃ½</th></tr>";
      snap.forEach(c=>{
        html+=`<tr><td>${c.key}</td></tr>`;
      });
      html+="</table>";
      manageTable.innerHTML=html;
    });
}

/* ===== THEME ===== */
function toggleTheme(){
  document.body.classList.toggle("light");
  localStorage.theme=document.body.classList.contains("light")?"light":"dark";
}
if(localStorage.theme==="light"){
  document.body.classList.add("light");
}

/* ===== SW ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
