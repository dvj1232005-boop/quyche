<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3d2e">

<style>
/* ================= THEME ================= */
:root{
  --bg:linear-gradient(180deg,#e9fff6,#f7fbff);
  --card:#ffffff;
  --text:#0f172a;
  --accent:#0b8f6a;
}
body.dark{
  --bg:linear-gradient(180deg,#071e17,#04140f);
  --card:#0f2a22;
  --text:#ecfdf5;
  --accent:#3bffb4;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
}

/* ================= INTRO ================= */
#intro{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#0b3d2e,#062a20);
  z-index:9999;
  display:flex;
  justify-content:center;
  align-items:center;
  animation:introOut 1s ease forwards;
  animation-delay:3.5s;
}
.intro-box{
  text-align:center;
  color:white;
}
.intro-logo{
  width:120px;
  border-radius:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
  animation:logoPop 1.2s ease;
}
@keyframes logoPop{
  from{transform:scale(.6);opacity:0}
  to{transform:scale(1);opacity:1}
}
@keyframes introOut{
  to{opacity:0;visibility:hidden}
}

/* ================= LAYOUT ================= */
.container{
  width:100%;
  max-width:420px;
  padding:20px;
}
.card{
  background:var(--card);
  border-radius:24px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle{cursor:pointer;font-size:20px}

/* ================= FORM ================= */
input,select{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:15px;
}
table{width:100%}
td{padding:6px 0}
.day{font-weight:600}

button{
  margin-top:14px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,#e53935,#ff6b6b);
  color:white;
  font-size:16px;
  font-weight:700;
}

/* ================= MANAGER ================= */
.manager-box{
  margin-top:16px;
  background:rgba(0,0,0,.05);
  padding:14px;
  border-radius:14px;
}
.group{
  margin-bottom:12px;
}
.group h4{
  margin:6px 0;
}

/* ================= SNOW ================= */
.snow{
  position:fixed;
  top:-10px;
  color:white;
  font-size:10px;
  animation:fall linear forwards;
  z-index:5;
}
@keyframes fall{
  to{transform:translateY(110vh);opacity:0}
}

/* ================= TREE ================= */
.tree{
  position:fixed;
  bottom:20px;
  left:20px;
  width:80px;
}
.tree .star{text-align:center}
.layer{
  border-left:40px solid transparent;
  border-right:40px solid transparent;
  border-bottom:50px solid #1f8f5f;
  margin:-18px auto;
}
.trunk{
  width:18px;height:20px;
  background:#7a4a1c;
  margin:auto;
}

/* ================= FOOTER ================= */
.footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  margin-top:16px;
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div class="intro-box">
    <img src="logo.jpg" class="intro-logo">
    <h2>An Quy Ch·∫ø</h2>
    <p>H·ªá th·ªëng ƒëƒÉng k√Ω ca l√†m</p>
  </div>
</div>

<!-- TREE -->
<div class="tree">
  <div class="star">‚≠ê</div>
  <div class="layer"></div>
  <div class="layer"></div>
  <div class="layer"></div>
  <div class="trunk"></div>
</div>

<div class="container">
  <div class="card">
    <div class="header">
      <h3>üéÑ ƒêƒÉng k√Ω ca l√†m</h3>
      <div class="toggle" onclick="toggleTheme()">üåô</div>
    </div>

    <input id="name" placeholder="Nh·∫≠p t√™n (Qu·∫£n l√Ω: QuanLy)">

    <table id="schedule"></table>

    <button onclick="submit()">üë∑‚Äç‚ôÇÔ∏è X√°c nh·∫≠n ƒëƒÉng k√Ω</button>

    <div id="managerBox" class="manager-box" style="display:none"></div>
  </div>

  <div class="footer">
    ¬© 2025 An Quy Ch·∫ø ‚Ä¢ Developed by ƒê√†o ƒêƒÉng T√πng
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  databaseURL:"https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"an-quy"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const days=["T2","T3","T4","T5","T6","T7","CN"];
const shifts=["C1","C2","C3","2C(C1+C2)","2C(C2+C3)","F1","F2"];
const table=document.getElementById("schedule");

days.forEach(d=>{
  table.innerHTML+=`
    <tr><td class="day">${d}</td>
    <td><select id="${d}">
      <option value="">‚Äî Kh√¥ng l√†m ‚Äî</option>
      ${shifts.map(s=>`<option>${s}</option>`).join("")}
    </select></td></tr>`;
});

/* ===== RESET TU·∫¶N ===== */
function mondayKey(){
  const d=new Date();
  const day=d.getDay()||7;
  d.setDate(d.getDate()-day+1);
  d.setHours(0,0,0,0);
  return d.getTime();
}

/* ===== SUBMIT ===== */
window.submit=async()=>{
  const name=nameEl.value.trim();
  if(!name) return alert("Ch∆∞a nh·∫≠p t√™n");

  if(name.toLowerCase()==="quanly"){
    const pin=prompt("Nh·∫≠p PIN qu·∫£n l√Ω");
    if(pin!=="2005") return alert("Sai PIN");

    const box=document.getElementById("managerBox");
    box.style.display="block";
    box.innerHTML="<h4>T·ªïng h·ª£p ca</h4>";

    const snap=await get(ref(db,"dangKy/"+mondayKey()));
    if(!snap.exists()) return box.innerHTML+="<p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>";

    const map={};
    snap.forEach(n=>{
      const lich=n.val().lich||{};
      for(const d in lich){
        const k=`${d}-${lich[d]}`;
        map[k]=map[k]||[];
        map[k].push(n.key);
      }
    });

    Object.keys(map).forEach(k=>{
      box.innerHTML+=`
        <div class="group">
          <b>${k}</b>: ${map[k].join(", ")}
        </div>`;
    });

    box.innerHTML+=`
      <button onclick="clearWeek()">üóë X√≥a tu·∫ßn</button>`;
    return;
  }

  const lich={};
  days.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) lich[d]=v;
  });

  await set(ref(db,`dangKy/${mondayKey()}/${name}`),{lich});
  alert("ƒê√£ g·ª≠i l·ªãch");
};

window.clearWeek=async()=>{
  if(confirm("X√≥a to√†n b·ªô l·ªãch tu·∫ßn n√†y?")){
    await remove(ref(db,"dangKy/"+mondayKey()));
    location.reload();
  }
};

window.toggleTheme=()=>document.body.classList.toggle("dark");

/* ===== SNOW ===== */
setInterval(()=>{
  const s=document.createElement("div");
  s.className="snow";
  s.textContent="‚ùÑ";
  s.style.left=Math.random()*100+"vw";
  s.style.animationDuration=(3+Math.random()*4)+"s";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),7000);
},300);

/* ===== SW ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
